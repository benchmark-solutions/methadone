__m=(function(){__Annotated____Util=new (function(){this.getOrCreate=function(a){var c=window;a=a.split(".");for(var b in a){if(a.hasOwnProperty(b)){c[a[b]]=c[a[b]]||{};c=c[a[b]]}}return c};this.extend=function(b){var a=Array.prototype.slice.call(arguments).slice(1);for(options in a){if(a.hasOwnProperty(options)){options=a[options];for(name in options){copy=options[name];if(b!==copy&&copy!==undefined){b[name]=copy}}}}return b};this.cache=function(a){var c={};for(var b=0;b<a.length;b++){c[a[b]]=this.getOrCreate(a[b])}return c};this.logError=function(a){console.error(a);__Annotated__.State.getInstance().errors.push(a);__Annotated__.State.getInstance().valid=false};this.keys=function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){a.push(b)}}return a};this.assign=function(c,g){var f=c.split(".");var e=f[0];var b=window;if(f.length>1){var a=window[e];for(var d=1;d<f.length;d++){e=f[d];b=a;a=a[e]}}b[e]=__Annotated____Util.extend(g,b[e])}})();__Annotated____Container=new (function(){this.loadModules=function(){var h=true;var l=0;var m=0;var d={};var e=[];if(__Annotated__.State.getInstance().compile){__Annotated__.State.getInstance().script+=__Annotated__.Reflect.render("__m","__Annotated____Util","__Annotated____Container")}if(__Annotated__.State.getInstance().ir){__Annotated__.State.getInstance().ir=__Annotated__.State.getInstance().ir.reverse();while(__Annotated__.State.getInstance().ir.length>0){initializeModule(__Annotated__.State.getInstance().ir.pop())}}else{while(h&&__Annotated__.State.getInstance().valid){for(var j in __Annotated__.State.getInstance().modules){if(__Annotated__.State.getInstance().modules.hasOwnProperty(j)){var f=__Annotated__.State.getInstance().modules[j];if(!d[f.name]){var b=true;for(var a in f.imports){if(f.imports.hasOwnProperty(a)){if(!d[a]){b=false}}}if(b){if(__Annotated__.State.getInstance().preprocess){e.push({name:f.name,mixins:f.mixins,type:f.type})}else{if(__Annotated__.State.getInstance().compile){__Annotated__.State.getInstance().script+='__m.getOrCreate("'+f.name+'");\n__m.assign("'+f.name+'", '+f.raw_code+");\n__m.initializeModule("+JSON.stringify({name:f.name,mixins:f.mixins,type:f.type,root:f.root})+");\n"}else{this.initializeModule(f)}}delete (__Annotated__.State.getInstance().uninitialized[f.name]);d[f.name]=true;m++}}}}if(l===m){var c=0;for(var g in __Annotated__.State.getInstance().uninitialized){c++}if(c>0){__Annotated____Util.logError("Dependencies are unsatisfiable for "+JSON.stringify(__Annotated____Util.keys(__Annotated__.State.getInstance().uninitialized))+"; not loaded")}h=false}l=m}if(__Annotated__.State.getInstance().preprocess){__Annotated__.State.getInstance().ir="annotated.setIR("+JSON.stringify(e)+");"}}};this.initializeModule=function(a){var c=[];var b=[];if(a.type==="Module"){b.push({});c.push({});var e=__Annotated____Util.getOrCreate(a.name);this.processMixins(a,b,c);e.apply(b[b.length-1]);this.checkForProperties(b[b.length-1],a.name);if(a.root){__Annotated____Util.assign(a.name,__Annotated____Util.extend(b[b.length-1][a.root],b[b.length-1]))}else{__Annotated____Util.assign(a.name,b[b.length-1])}b.pop();c.pop()}else{var d=this.generateClassConstructor(a,__Annotated____Util.getOrCreate(a.name),b,c);__Annotated____Util.assign(a.name,d)}};this.checkForProperties=function(b,a){for(var c in b){if(b.hasOwnProperty(c)){if(typeof b[c]!=="function"&&typeof b[c]!=="undefined"){__Annotated____Util.logError("Module "+a+" has illegal public property "+c)}}}};this.generateClassConstructor=function(d,e,a,b){var c=this;return function(){if(b.length>0&&b[b.length-1][d.name]){a.push(a[a.length-1]);delete (b[b.length-1][d.name])}else{a.push(this)}b.push({});c.processMixins(d,a,b);var f=Array.prototype.slice.call(arguments);e.apply(a[a.length-1],f);b.pop();return a.pop()}};this.getOrCreate=function(a){var c=window;a=a.split(".");for(var b in a){if(a.hasOwnProperty(b)){c[a[b]]=c[a[b]]||{};c=c[a[b]]}}return c};this.assign=function(c,g){var f=c.split(".");var e=f[0];var b=window;if(f.length>1){var a=window[e];for(var d=1;d<f.length;d++){e=f[d];b=a;a=a[e]}}b[e]=__Annotated____Util.extend(g,b[e])};this.processMixins=function(e,a,b){for(var c in e.mixins){if(e.mixins[c]==="MODULE"){__Annotated____Util.extend(a[a.length-1],__Annotated____Util.getOrCreate(c))}else{if(e.mixins[c]==="INSTANCE"){b[b.length-1][c]=true}else{var d=__Annotated____Util.getOrCreate(c);__Annotated____Util.extend(a[a.length-1],new d())}}}}})();return __Annotated____Container})();__m.getOrCreate("Annotated.State.__Internal");__m.assign("Annotated.State.__Internal",function(){this.strict=false;this.valid=true;this.initialized=false;this.uninitialized={};this.errors=[];this.modules={};this.autoinit=true;this.preprocess=false;this.compile=false;this.script=""});__m.initializeModule({name:"Annotated.State.__Internal",mixins:{},type:"Class"});__m.getOrCreate("Annotated.State");__m.assign("Annotated.State",function(){Import:var a=Annotated.State.__Internal;var b;this.getInstance=function(){return b};this.getErrors=function(){return b.errors};this.setCompile=function(c){b.compile=c};this.setIR=function(c){b.ir=c};this.getIR=function(){return b.ir};this.setPreprocess=function(c){b.preprocess=c};this.getPreprocess=function(){return b.preprocess};this.getScript=function(){return b.script};this.reset=function(){b=new Annotated.State.__Internal()};this.reset()});__m.initializeModule({name:"Annotated.State",mixins:{},type:"Module"});__m.getOrCreate("Annotated.Util");__m.assign("Annotated.Util",function(){Import:Annotated.State;this.getOrCreate=function(a){var c=window;a=a.split(".");for(var b in a){if(a.hasOwnProperty(b)){c[a[b]]=c[a[b]]||{};c=c[a[b]]}}return c};this.extend=function(b){var a=Array.prototype.slice.call(arguments).slice(1);for(options in a){if(a.hasOwnProperty(options)){options=a[options];for(name in options){copy=options[name];if(b!==copy&&copy!==undefined){b[name]=copy}}}}return b};this.cache=function(a){var c={};for(var b=0;b<a.length;b++){c[a[b]]=this.getOrCreate(a[b])}return c};this.logError=function(a){console.error(a);Annotated.State.getInstance().errors.push(a);Annotated.State.getInstance().valid=false};this.keys=function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){a.push(b)}}return a};this.assign=function(c,g){var f=c.split(".");var e=f[0];var b=window;if(f.length>1){var a=window[e];for(var d=1;d<f.length;d++){e=f[d];b=a;a=a[e]}}b[e]=Annotated.Util.extend(g,b[e])}});__m.initializeModule({name:"Annotated.Util",mixins:{},type:"Module"});__m.getOrCreate("Annotated.Reflect.Parse");__m.assign("Annotated.Reflect.Parse",function(){Import:Annotated.State;Import:Annotated.Util;this.clean=function(a){var e=new RegExp("(\\/\\/|\\/\\*|\\\\\"|\\\\'|[\\(,=^;]\\s*?/(?!/)|\\/|/)|['\"]","gm");var g=false;var j="";var b=null;var h=[];while(quote=e.exec(a)){if((quote[0]==='\\"'||quote[0]==="\\'"||quote[0]==="\\/")&&g){}else{if(quote[0]===j&&g){j="";g=false;h.push([b,e.lastIndex])}else{if(quote[0][quote[0].length-1]==="/"&&j==="/"){j="";g=false;h.push([b,e.lastIndex])}else{if(quote[0]==="//"&&!g){var d=/$/gm;d.lastIndex=e.lastIndex;d.exec(a);h.push([e.lastIndex,d.lastIndex]);e.lastIndex=d.lastIndex}else{if(quote[0]==="/*"&&!g){var c=/\*\//gm;c.lastIndex=e.lastIndex;c.exec(a);h.push([e.lastIndex,c.lastIndex]);e.lastIndex=c.lastIndex}else{if(quote[0][quote[0].length-1]==="/"&&!g){j="/";g=true;b=e.lastIndex}else{if(g){}else{if(quote[0]==="'"||quote[0]==='"'){j=quote[0];g=true;b=e.lastIndex}}}}}}}}}h=h.reverse();for(var f in h){if(h.hasOwnProperty(f)){a=a.slice(0,h[f][0]-1)+a.slice(h[f][1],a.length)}}return a};this.findModules=function(e){var g=new RegExp("(^|;|{)\\s*(Module|Class)\\s*:","gm");var d=new RegExp("(^|;|{)\\s*Strict\\s*?:\\s*?true","gm");var c=new RegExp("(^|;|{)\\s*Init\\s*?:\\s*?false","gm");var b=[];if(d.exec(e)){Annotated.State.getInstance().strict=true}if(c.exec(e)){Annotated.State.getInstance().autoinit=false}while(moduleParsed=g.exec(e)){var f=e.slice(g.lastIndex).match(/\s*(.*?)\s*?=\s*?function/)[1];var a=moduleParsed[2];this.validateModule(f);Annotated.Util.getOrCreate(f);Annotated.State.getInstance().uninitialized[f]=true;Annotated.State.getInstance().modules[f]={name:f,type:a};b.push(f)}return b};this.findTaggedSymbols=function(d,c){var b={};regex=new RegExp("(^|;|{)\\s*("+c+")\\s*:\\s*((var)?\\s+[a-zA-Z0-9_\\$]+\\s*=\\s*)?","gm");while(regex.exec(d.code)){var a=d.code.slice(regex.lastIndex).match(/([a-zA-Z0-9_\\.\\$]+)(\()?/);if(c==="Root"){b[a[1].replace("this.","")]="ROOT"}else{if(Annotated.State.getInstance().modules.hasOwnProperty(a[1])){if(Annotated.State.getInstance().modules[a[1]].type==="Class"&&d.type==="Module"&&c==="Mixin"){Annotated.Util.logError("Module "+d.name+" cannot mixin Class "+a[1])}else{if(a[2]!=undefined&&a[2]!=""){b[a[1]]="INSTANCE"}else{if(Annotated.State.getInstance().modules[a[1]].type==="Module"){b[a[1]]="MODULE"}else{b[a[1]]="STATIC"}}}}else{Annotated.Util.logError("Module "+d.name+" declares an illegal "+c+": "+a[1])}}}return b};this.findImplicitModules=function(b,f){var a={};for(var g in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(g)&&b!=g){var e=new RegExp("(^|;|{|\\(|\\*|\\+|-|=|\\\\)\\s*"+g.replace(".","\\.").replace("$","\\$")+"(?![a-zA-Z0-9_\\$])","gm");match:while(e.exec(f)){for(var d in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(d)&&d!=g){var c=new RegExp(d.replace(".","\\.").replace("$","\\$")+"(?![a-zA-Z0-9_\\$])","gm");c.lastIndex=e.lastIndex-g.length;if(path=c.exec(f)){if((c.lastIndex-e.lastIndex)==(d.length-g.length)){continue match}}}}if(!Annotated.State.getInstance().strict){a[g]=true}else{if(!Annotated.State.getInstance().modules[b].imports[g]){Annotated.Util.logError("Undeclared dependency "+g+" in "+b)}}}}}return a};this.validateModule=function(a){for(module in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(module)&&Annotated.State.getInstance().modules[module].name===a){Annotated.Util.logError(a+" declared twice")}}}});__m.initializeModule({name:"Annotated.Reflect.Parse",mixins:{},type:"Module"});__m.getOrCreate("Annotated.Container");__m.assign("Annotated.Container",function(){Import:Annotated.State;Import:Annotated.Util;this.loadModules=function(){var h=true;var l=0;var m=0;var d={};var e=[];if(Annotated.State.getInstance().compile){Annotated.State.getInstance().script+=Annotated.Reflect.render("__m","Annotated.Util","Annotated.Container")}if(Annotated.State.getInstance().ir){Annotated.State.getInstance().ir=Annotated.State.getInstance().ir.reverse();while(Annotated.State.getInstance().ir.length>0){initializeModule(Annotated.State.getInstance().ir.pop())}}else{while(h&&Annotated.State.getInstance().valid){for(var j in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(j)){var f=Annotated.State.getInstance().modules[j];if(!d[f.name]){var b=true;for(var a in f.imports){if(f.imports.hasOwnProperty(a)){if(!d[a]){b=false}}}if(b){if(Annotated.State.getInstance().preprocess){e.push({name:f.name,mixins:f.mixins,type:f.type})}else{if(Annotated.State.getInstance().compile){Annotated.State.getInstance().script+='__m.getOrCreate("'+f.name+'");\n__m.assign("'+f.name+'", '+f.raw_code+");\n__m.initializeModule("+JSON.stringify({name:f.name,mixins:f.mixins,type:f.type,root:f.root})+");\n"}else{this.initializeModule(f)}}delete (Annotated.State.getInstance().uninitialized[f.name]);d[f.name]=true;m++}}}}if(l===m){var c=0;for(var g in Annotated.State.getInstance().uninitialized){c++}if(c>0){Annotated.Util.logError("Dependencies are unsatisfiable for "+JSON.stringify(Annotated.Util.keys(Annotated.State.getInstance().uninitialized))+"; not loaded")}h=false}l=m}if(Annotated.State.getInstance().preprocess){Annotated.State.getInstance().ir="annotated.setIR("+JSON.stringify(e)+");"}}};this.initializeModule=function(a){var c=[];var b=[];if(a.type==="Module"){b.push({});c.push({});var e=Annotated.Util.getOrCreate(a.name);this.processMixins(a,b,c);e.apply(b[b.length-1]);this.checkForProperties(b[b.length-1],a.name);if(a.root){Annotated.Util.assign(a.name,Annotated.Util.extend(b[b.length-1][a.root],b[b.length-1]))}else{Annotated.Util.assign(a.name,b[b.length-1])}b.pop();c.pop()}else{var d=this.generateClassConstructor(a,Annotated.Util.getOrCreate(a.name),b,c);Annotated.Util.assign(a.name,d)}};this.checkForProperties=function(b,a){for(var c in b){if(b.hasOwnProperty(c)){if(typeof b[c]!=="function"&&typeof b[c]!=="undefined"){Annotated.Util.logError("Module "+a+" has illegal public property "+c)}}}};this.generateClassConstructor=function(d,e,a,b){var c=this;return function(){if(b.length>0&&b[b.length-1][d.name]){a.push(a[a.length-1]);delete (b[b.length-1][d.name])}else{a.push(this)}b.push({});c.processMixins(d,a,b);var f=Array.prototype.slice.call(arguments);e.apply(a[a.length-1],f);b.pop();return a.pop()}};this.getOrCreate=Annotated.Util.getOrCreate;this.assign=Annotated.Util.assign;this.processMixins=function(e,a,b){for(var c in e.mixins){if(e.mixins[c]==="MODULE"){Annotated.Util.extend(a[a.length-1],Annotated.Util.getOrCreate(c))}else{if(e.mixins[c]==="INSTANCE"){b[b.length-1][c]=true}else{var d=Annotated.Util.getOrCreate(c);Annotated.Util.extend(a[a.length-1],new d())}}}}});__m.initializeModule({name:"Annotated.Container",mixins:{},type:"Module"});__m.getOrCreate("Annotated.Init");__m.assign("Annotated.Init",function(b){Import:Annotated.State;var a=false;this.registerInitializer=function(){if(!a){__init=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){if(Annotated.State.getInstance().autoinit){b()}},false)}else{if(document.attachEvent){timer=function(){setTimeout(function(){if(window.document.readyState=="complete"){if(Annotated.State.getInstance().autoinit){b()}}else{timer()}},500)};timer()}}}}});__m.initializeModule({name:"Annotated.Init",mixins:{},type:"Module"});__m.getOrCreate("Annotated.Reflect");__m.assign("Annotated.Reflect",function(){Import:Annotated.Reflect.Parse;Import:Annotated.State;Import:Annotated.Util;this.parseModules=function(){for(var f in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(f)){var b=Annotated.State.getInstance().modules[f];b.code=Annotated.Reflect.Parse.clean(Annotated.Util.getOrCreate(f).toString());b.raw_code=Annotated.Util.getOrCreate(f).toString();var e=Annotated.Reflect.Parse.findTaggedSymbols(b,"Import");var d=Annotated.Reflect.Parse.findTaggedSymbols(b,"Mixin");var c=Annotated.Reflect.Parse.findTaggedSymbols(b,"Root");b.imports=Annotated.Util.extend({},e,d);b.mixins=d;b.root=Annotated.Util.keys(c)[0];b.imports=Annotated.Util.extend(b.imports,Annotated.Reflect.Parse.findImplicitModules(f,b.code))}}};this.parseAnnotated=function(b){b=Annotated.Reflect.Parse.clean(b);return Annotated.Reflect.Parse.findModules(b)};var a=function(d){var b="";for(var e=0;e<d.length;e++){var f=d[e];b+=f.replace(".","__")+"=new (function() {";module_instance=Annotated.Util.getOrCreate(f);for(var c in module_instance){if(module_instance.hasOwnProperty(c)){b+="this."+c+"="+module_instance[c].toString()+";"}}b+="})();\n"}return b};this.render=function(d){var c=Array.prototype.slice.call(arguments);var b=d+"=(function(){"+a(c.slice(1))+";return "+c[c.length-1]+"})();";for(i=1;i<c.length;i++){b=b.replace(new RegExp(c[i],"gm"),c[i].replace(".","__"))}return b}});__m.initializeModule({name:"Annotated.Reflect",mixins:{},type:"Module"});__m.getOrCreate("Annotated");__m.assign("Annotated",function(){Mixin:Annotated.State;Import:var e=Annotated.Container;Import:var c=Annotated.Init;Import:var d=Annotated.Reflect;Import:var b=Annotated.Util;this.reset();var a=this.getInstance;Root:this.__scope__=function(j){var g=undefined;if(a().ir&&a().valid){a().valid=false;for(var h=0;h<a().ir.length;h++){b.getOrCreate(a().ir[h].name)}}else{if(!a().ir){g=b.cache(d.parseAnnotated(j.toString()))}}j();if(!a().ir){for(var f in g){if(g.hasOwnProperty(f)){b.extend(b.getOrCreate(f),g[f])}}}c.registerInitializer(this.initialize)};this.initialize=function(){if(!a().initialized){a().initialized=true;if(!a().ir){d.parseModules()}e.loadModules()}}});__m.initializeModule({name:"Annotated",mixins:{"Annotated.State":"MODULE"},type:"Module",root:"__scope__"});annotated=Annotated;
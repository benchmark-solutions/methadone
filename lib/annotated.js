__m=new (function(){this.initializeModule=function(b){var d=[];var c=[];if(b.type==="Module"){c.push({});d.push({});var f=a.Util.getOrCreate(b.name);this.processMixins(b,c,d);f.apply(c[c.length-1]);this.checkForProperties(c[c.length-1],b.name);if(b.root){a.Util.assign(b.name,a.Util.extend(c[c.length-1][b.root],c[c.length-1]))}else{a.Util.assign(b.name,c[c.length-1])}c.pop();d.pop()}else{var e=this.generateClassConstructor(b,a.Util.getOrCreate(b.name),c,d);a.Util.assign(b.name,e)}};this.checkForProperties=function(c,b){for(var d in c){if(c.hasOwnProperty(d)){if(typeof c[d]!=="function"&&typeof c[d]!=="undefined"){a.Util.logError("Module "+b+" has illegal public property "+d)}}}};this.generateClassConstructor=function(e,f,b,c){var d=this;return function(){if(c.length>0&&c[c.length-1][e.name]){b.push(b[b.length-1]);delete (c[c.length-1][e.name])}else{b.push(this)}c.push({});d.processMixins(e,b,c);var g=Array.prototype.slice.call(arguments);f.apply(b[b.length-1],g);c.pop();return b.pop()}};this.processMixins=function(f,b,c){for(var d in f.mixins){if(f.mixins[d]==="MODULE"){a.Util.extend(b[b.length-1],a.Util.getOrCreate(d))}else{if(f.mixins[d]==="INSTANCE"){c[c.length-1][d]=true}else{var e=a.Util.getOrCreate(d);a.Util.extend(b[b.length-1],new e())}}}};var a={};a.Util={};a.Util.extend=function(c){var b=Array.prototype.slice.call(arguments).slice(1);for(options in b){if(b.hasOwnProperty(options)){options=b[options];for(name in options){copy=options[name];if(c!==copy&&copy!==undefined){c[name]=copy}}}}return c};this.extend=a.Util.extend;a.Util.assign=function(d,h){var g=d.split(".");var f=g[0];var c=window;if(g.length>1){var b=window[f];for(var e=1;e<g.length;e++){f=g[e];c=b;b=b[f]}}c[f]=a.Util.extend(h,c[f])};this.assign=a.Util.assign;a.Util.keys=function(d,h){var g=d.split(".");var f=g[0];var c=window;if(g.length>1){var b=window[f];for(var e=1;e<g.length;e++){f=g[e];c=b;b=b[f]}}c[f]=a.Util.extend(h,c[f])};a.Util.getOrCreate=function(b){var d=window;b=b.split(".");for(var c in b){if(b.hasOwnProperty(c)){d[b[c]]=d[b[c]]||{};d=d[b[c]]}}return d};this.getOrCreate=a.Util.getOrCreate})();__m.getOrCreate("Annotated.State.__Internal");__m.assign("Annotated.State.__Internal",function(){this.strict=false;this.valid=true;this.initialized=false;this.uninitialized={};this.errors=[];this.modules={};this.autoinit=true;this.preprocess=false;this.compile=false;this.script=""});__m.initializeModule({name:"Annotated.State.__Internal",mixins:{},type:"Class"});__m.getOrCreate("Annotated.State");__m.assign("Annotated.State",function(){Import:var a=Annotated.State.__Internal;var b;this.getInstance=function(){return b};this.getErrors=function(){return b.errors};this.setCompile=function(c){b.compile=c};this.setIR=function(c){b.ir=c};this.getIR=function(){return b.ir};this.setPreprocess=function(c){b.preprocess=c};this.getPreprocess=function(){return b.preprocess};this.getScript=function(){return b.script};this.reset=function(){b=new Annotated.State.__Internal()};this.reset()});__m.initializeModule({name:"Annotated.State",mixins:{},type:"Module"});__m.getOrCreate("Annotated.Util");__m.assign("Annotated.Util",function(){Import:Annotated.State;this.getOrCreate=function(a){var c=window;a=a.split(".");for(var b in a){if(a.hasOwnProperty(b)){c[a[b]]=c[a[b]]||{};c=c[a[b]]}}return c};this.extend=function(b){var a=Array.prototype.slice.call(arguments).slice(1);for(options in a){if(a.hasOwnProperty(options)){options=a[options];for(name in options){copy=options[name];if(b!==copy&&copy!==undefined){b[name]=copy}}}}return b};this.cache=function(a){var c={};for(var b=0;b<a.length;b++){c[a[b]]=this.getOrCreate(a[b])}return c};this.logError=function(a){console.error(a);Annotated.State.getInstance().errors.push(a);Annotated.State.getInstance().valid=false};this.keys=function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){a.push(b)}}return a};this.assign=function(c,g){var f=c.split(".");var e=f[0];var b=window;if(f.length>1){var a=window[e];for(var d=1;d<f.length;d++){e=f[d];b=a;a=a[e]}}b[e]=Annotated.Util.extend(g,b[e])}});__m.initializeModule({name:"Annotated.Util",mixins:{},type:"Module"});__m.getOrCreate("Annotated.Reflect.Parse");__m.assign("Annotated.Reflect.Parse",function(){Import:Annotated.State;Import:Annotated.Util;this.clean=function(a){var e=new RegExp("(\\/\\/|\\/\\*|\\\\\"|\\\\'|[\\(,=^;]\\s*?/(?!/)|\\/|/)|['\"]","gm");var g=false;var j="";var b=null;var h=[];while(quote=e.exec(a)){if((quote[0]==='\\"'||quote[0]==="\\'"||quote[0]==="\\/")&&g){}else{if(quote[0]===j&&g){j="";g=false;h.push([b,e.lastIndex])}else{if(quote[0][quote[0].length-1]==="/"&&j==="/"){j="";g=false;h.push([b,e.lastIndex])}else{if(quote[0]==="//"&&!g){var d=/$/gm;d.lastIndex=e.lastIndex;d.exec(a);h.push([e.lastIndex,d.lastIndex]);e.lastIndex=d.lastIndex}else{if(quote[0]==="/*"&&!g){var c=/\*\//gm;c.lastIndex=e.lastIndex;c.exec(a);h.push([e.lastIndex,c.lastIndex]);e.lastIndex=c.lastIndex}else{if(quote[0][quote[0].length-1]==="/"&&!g){j="/";g=true;b=e.lastIndex}else{if(g){}else{if(quote[0]==="'"||quote[0]==='"'){j=quote[0];g=true;b=e.lastIndex}}}}}}}}}h=h.reverse();for(var f in h){if(h.hasOwnProperty(f)){a=a.slice(0,h[f][0]-1)+a.slice(h[f][1],a.length)}}return a};this.findModules=function(e){var g=new RegExp("(^|;|{)\\s*(Module|Class)\\s*:","gm");var d=new RegExp("(^|;|{)\\s*Strict\\s*?:\\s*?true","gm");var c=new RegExp("(^|;|{)\\s*Init\\s*?:\\s*?false","gm");var b=[];if(d.exec(e)){Annotated.State.getInstance().strict=true}if(c.exec(e)){Annotated.State.getInstance().autoinit=false}while(moduleParsed=g.exec(e)){var f=e.slice(g.lastIndex).match(/\s*(.*?)\s*?=\s*?function/)[1];var a=moduleParsed[2];this.validateModule(f);Annotated.Util.getOrCreate(f);Annotated.State.getInstance().uninitialized[f]=true;Annotated.State.getInstance().modules[f]={name:f,type:a};b.push(f)}return b};this.findTaggedSymbols=function(d,c){var b={};regex=new RegExp("(^|;|{)\\s*("+c+")\\s*:\\s*((var)?\\s+[a-zA-Z0-9_\\$]+\\s*=\\s*)?","gm");while(regex.exec(d.code)){var a=d.code.slice(regex.lastIndex).match(/([a-zA-Z0-9_\\.\\$]+)(\()?/);if(c==="Root"){b[a[1].replace("this.","")]="ROOT"}else{if(Annotated.State.getInstance().modules.hasOwnProperty(a[1])){if(Annotated.State.getInstance().modules[a[1]].type==="Class"&&d.type==="Module"&&c==="Mixin"){Annotated.Util.logError("Module "+d.name+" cannot mixin Class "+a[1])}else{if(a[2]!=undefined&&a[2]!=""){b[a[1]]="INSTANCE"}else{if(Annotated.State.getInstance().modules[a[1]].type==="Module"){b[a[1]]="MODULE"}else{b[a[1]]="STATIC"}}}}else{Annotated.Util.logError("Module "+d.name+" declares an illegal "+c+": "+a[1])}}}return b};this.findImplicitModules=function(b,f){var a={};for(var g in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(g)&&b!=g){var e=new RegExp("(^|;|{|\\(|\\*|\\+|-|=|\\\\)\\s*"+g.replace(".","\\.").replace("$","\\$")+"(?![a-zA-Z0-9_\\$])","gm");match:while(e.exec(f)){for(var d in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(d)&&d!=g){var c=new RegExp(d.replace(".","\\.").replace("$","\\$")+"(?![a-zA-Z0-9_\\$])","gm");c.lastIndex=e.lastIndex-g.length;if(path=c.exec(f)){if((c.lastIndex-e.lastIndex)==(d.length-g.length)){continue match}}}}if(!Annotated.State.getInstance().strict){a[g]=true}else{if(!Annotated.State.getInstance().modules[b].imports[g]){Annotated.Util.logError("Undeclared dependency "+g+" in "+b)}}}}}return a};this.validateModule=function(a){for(module in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(module)&&Annotated.State.getInstance().modules[module].name===a){Annotated.Util.logError(a+" declared twice")}}}});__m.initializeModule({name:"Annotated.Reflect.Parse",mixins:{},type:"Module"});__m.getOrCreate("Annotated.Container");__m.assign("Annotated.Container",function(){Import:Annotated.State;Import:Annotated.Util;this.loadModules=function(){var h=true;var j=0;var l=0;var d={};var e=[];if(Annotated.State.getInstance().compile){Annotated.State.getInstance().script+="__m = new (function() {this.initializeModule="+this.initializeModule.toString()+"\nthis.checkForProperties="+this.checkForProperties.toString()+"\nthis.generateClassConstructor="+this.generateClassConstructor.toString()+"\nthis.processMixins="+this.processMixins.toString()+"\nvar Annotated = {};Annotated.Util = {};\nAnnotated.Util.extend="+Annotated.Util.extend.toString()+"\nthis.extend = Annotated.Util.extend\nAnnotated.Util.assign="+Annotated.Util.assign.toString()+"\nthis.assign = Annotated.Util.assign\nAnnotated.Util.keys="+Annotated.Util.assign.toString()+"\nAnnotated.Util.getOrCreate="+Annotated.Util.getOrCreate.toString()+"\nthis.getOrCreate = Annotated.Util.getOrCreate})();"}if(Annotated.State.getInstance().ir){Annotated.State.getInstance().ir=Annotated.State.getInstance().ir.reverse();while(Annotated.State.getInstance().ir.length>0){initializeModule(Annotated.State.getInstance().ir.pop())}}else{while(h&&Annotated.State.getInstance().valid){for(var i in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(i)){var f=Annotated.State.getInstance().modules[i];if(!d[f.name]){var b=true;for(var a in f.imports){if(f.imports.hasOwnProperty(a)){if(!d[a]){b=false}}}if(b){if(Annotated.State.getInstance().preprocess){e.push({name:f.name,mixins:f.mixins,type:f.type})}else{if(Annotated.State.getInstance().compile){Annotated.State.getInstance().script+='__m.getOrCreate("'+f.name+'");\n__m.assign("'+f.name+'", '+f.raw_code+");\n__m.initializeModule("+JSON.stringify({name:f.name,mixins:f.mixins,type:f.type,root:f.root})+");\n"}else{this.initializeModule(f)}}delete (Annotated.State.getInstance().uninitialized[f.name]);d[f.name]=true;l++}}}}if(j===l){var c=0;for(var g in Annotated.State.getInstance().uninitialized){c++}if(c>0){Annotated.Util.logError("Dependencies are unsatisfiable for "+JSON.stringify(Annotated.Util.keys(Annotated.State.getInstance().uninitialized))+"; not loaded")}h=false}j=l}if(Annotated.State.getInstance().preprocess){Annotated.State.getInstance().ir="annotated.setIR("+JSON.stringify(e)+");"}}};this.initializeModule=function(a){var c=[];var b=[];if(a.type==="Module"){b.push({});c.push({});var e=Annotated.Util.getOrCreate(a.name);this.processMixins(a,b,c);e.apply(b[b.length-1]);this.checkForProperties(b[b.length-1],a.name);if(a.root){Annotated.Util.assign(a.name,Annotated.Util.extend(b[b.length-1][a.root],b[b.length-1]))}else{Annotated.Util.assign(a.name,b[b.length-1])}b.pop();c.pop()}else{var d=this.generateClassConstructor(a,Annotated.Util.getOrCreate(a.name),b,c);Annotated.Util.assign(a.name,d)}};this.checkForProperties=function(b,a){for(var c in b){if(b.hasOwnProperty(c)){if(typeof b[c]!=="function"&&typeof b[c]!=="undefined"){Annotated.Util.logError("Module "+a+" has illegal public property "+c)}}}};this.generateClassConstructor=function(d,e,a,b){var c=this;return function(){if(b.length>0&&b[b.length-1][d.name]){a.push(a[a.length-1]);delete (b[b.length-1][d.name])}else{a.push(this)}b.push({});c.processMixins(d,a,b);var f=Array.prototype.slice.call(arguments);e.apply(a[a.length-1],f);b.pop();return a.pop()}};this.processMixins=function(e,a,b){for(var c in e.mixins){if(e.mixins[c]==="MODULE"){Annotated.Util.extend(a[a.length-1],Annotated.Util.getOrCreate(c))}else{if(e.mixins[c]==="INSTANCE"){b[b.length-1][c]=true}else{var d=Annotated.Util.getOrCreate(c);Annotated.Util.extend(a[a.length-1],new d())}}}}});__m.initializeModule({name:"Annotated.Container",mixins:{},type:"Module"});__m.getOrCreate("Annotated.Init");__m.assign("Annotated.Init",function(b){Import:Annotated.State;var a=false;this.registerInitializer=function(){if(!a){__init=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){if(Annotated.State.getInstance().autoinit){b()}},false)}else{if(document.attachEvent){timer=function(){setTimeout(function(){if(window.document.readyState=="complete"){if(Annotated.State.getInstance().autoinit){b()}}else{timer()}},500)};timer()}}}}});__m.initializeModule({name:"Annotated.Init",mixins:{},type:"Module"});__m.getOrCreate("Annotated.Reflect");__m.assign("Annotated.Reflect",function(){Import:Annotated.Reflect.Parse;Import:Annotated.State;Import:Annotated.Util;this.parseModules=function(){for(var e in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(e)){var a=Annotated.State.getInstance().modules[e];a.code=Annotated.Reflect.Parse.clean(Annotated.Util.getOrCreate(e).toString());a.raw_code=Annotated.Util.getOrCreate(e).toString();var d=Annotated.Reflect.Parse.findTaggedSymbols(a,"Import");var c=Annotated.Reflect.Parse.findTaggedSymbols(a,"Mixin");var b=Annotated.Reflect.Parse.findTaggedSymbols(a,"Root");a.imports=Annotated.Util.extend({},d,c);a.mixins=c;a.root=Annotated.Util.keys(b)[0];a.imports=Annotated.Util.extend(a.imports,Annotated.Reflect.Parse.findImplicitModules(e,a.code))}}};this.parseAnnotated=function(a){a=Annotated.Reflect.Parse.clean(a);return Annotated.Reflect.Parse.findModules(a)}});__m.initializeModule({name:"Annotated.Reflect",mixins:{},type:"Module"});__m.getOrCreate("Annotated");__m.assign("Annotated",function(){Mixin:Annotated.State;Import:Annotated.Container;Import:Annotated.Init;Import:Annotated.Reflect;Import:Annotated.Util;this.reset();var a=this.getInstance;delete (this["getInstance"]);Root:this.__scope__=function(e){var d=undefined;if(a().ir&&a().valid){a().valid=false;for(var c in a().ir){Annotated.Util.getOrCreate(a().ir[c].name)}}else{if(!a().ir){d=Annotated.Util.cache(Annotated.Reflect.parseAnnotated(e.toString()))}}e();if(!a().ir){for(var b in d){if(d.hasOwnProperty(b)){Annotated.Util.extend(Annotated.Util.getOrCreate(b),d[b])}}}Annotated.Init.registerInitializer(this.initialize)};this.initialize=function(){if(!a().initialized){a().initialized=true;if(!a().ir){Annotated.Reflect.parseModules()}Annotated.Container.loadModules()}}});__m.initializeModule({name:"Annotated",mixins:{"Annotated.State":"MODULE"},type:"Module",root:"__scope__"});annotated=Annotated;
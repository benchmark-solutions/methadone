__m=(function(){__Annotated____Loader=new (function(){this.initializeModule=function(a){var c=[];var b=[];if(a.type==="Module"){b.push({});c.push({});var e=this.getOrCreate(a.name);this.processMixins(a,b,c);e.apply(b[b.length-1]);if(a.root){this.assign(a.name,this.extend(b[b.length-1][a.root],b[b.length-1]))}else{this.assign(a.name,b[b.length-1])}b.pop();c.pop()}else{var d=this.generateClassConstructor(a,this.getOrCreate(a.name),b,c);this.assign(a.name,d)}};this.generateClassConstructor=function(d,e,a,b){var c=this;return function(){if(b.length>0&&b[b.length-1][d.name]){a.push(a[a.length-1]);delete (b[b.length-1][d.name])}else{a.push(this)}b.push({});c.processMixins(d,a,b);var f=Array.prototype.slice.call(arguments);e.apply(a[a.length-1],f);b.pop();return a.pop()}};this.processMixins=function(e,a,b){for(var c in e.mixins){if(e.mixins[c]==="MODULE"){this.extend(a[a.length-1],this.getOrCreate(c))}else{if(e.mixins[c]==="INSTANCE"){b[b.length-1][c]=true}else{var d=this.getOrCreate(c);this.extend(a[a.length-1],new d())}}}};this.assign=function(c,g){var f=c.split(".");var e=f[0];var b=window;if(f.length>1){var a=window[e];for(var d=1;d<f.length;d++){e=f[d];b=a;a=a[e]}}b[e]=this.extend(g,b[e])};this.getOrCreate=function(a){var d=window;a=a.split(".");for(var b=0;b<a.length;b++){var c=a[b];d[c]=d[c]||{};d=d[c]}return d};this.extend=function(d){var b=Array.prototype.slice.call(arguments).slice(1);for(var c=0;c<b.length;c++){var a=b[c];for(name in a){copy=a[name];if(d!==copy&&copy!==undefined){d[name]=copy}}}return d};this.load=function(a,b){this.getOrCreate(a.name);this.assign(a.name,b);this.initializeModule({name:a.name,mixins:a.mixins,type:a.type,root:a.root})+");\n"}})();return __Annotated____Loader})();__m.load({name:"Annotated.Loader",mixins:{},type:"Module"},function(){this.initializeModule=function(a){var c=[];var b=[];if(a.type==="Module"){b.push({});c.push({});var e=this.getOrCreate(a.name);this.processMixins(a,b,c);e.apply(b[b.length-1]);if(a.root){this.assign(a.name,this.extend(b[b.length-1][a.root],b[b.length-1]))}else{this.assign(a.name,b[b.length-1])}b.pop();c.pop()}else{var d=this.generateClassConstructor(a,this.getOrCreate(a.name),b,c);this.assign(a.name,d)}};this.generateClassConstructor=function(d,e,a,b){var c=this;return function(){if(b.length>0&&b[b.length-1][d.name]){a.push(a[a.length-1]);delete (b[b.length-1][d.name])}else{a.push(this)}b.push({});c.processMixins(d,a,b);var f=Array.prototype.slice.call(arguments);e.apply(a[a.length-1],f);b.pop();return a.pop()}};this.processMixins=function(e,a,b){for(var c in e.mixins){if(e.mixins[c]==="MODULE"){this.extend(a[a.length-1],this.getOrCreate(c))}else{if(e.mixins[c]==="INSTANCE"){b[b.length-1][c]=true}else{var d=this.getOrCreate(c);this.extend(a[a.length-1],new d())}}}};this.assign=function(c,g){var f=c.split(".");var e=f[0];var b=window;if(f.length>1){var a=window[e];for(var d=1;d<f.length;d++){e=f[d];b=a;a=a[e]}}b[e]=this.extend(g,b[e])};this.getOrCreate=function(a){var d=window;a=a.split(".");for(var b=0;b<a.length;b++){var c=a[b];d[c]=d[c]||{};d=d[c]}return d};this.extend=function(d){var b=Array.prototype.slice.call(arguments).slice(1);for(var c=0;c<b.length;c++){var a=b[c];for(name in a){copy=a[name];if(d!==copy&&copy!==undefined){d[name]=copy}}}return d};this.load=function(a,b){this.getOrCreate(a.name);this.assign(a.name,b);this.initializeModule({name:a.name,mixins:a.mixins,type:a.type,root:a.root})+");\n"}});__m.load({name:"Annotated.State.__Internal",mixins:{},type:"Class"},function(){this.strict=false;this.valid=true;this.initialized=false;this.uninitialized={};this.errors=[];this.modules={};this.autoinit=true;this.preprocess=false;this.compile=false;this.script=""});__m.load({name:"Annotated.State",mixins:{},type:"Module"},function(){Import:var a=Annotated.State.__Internal;var b;this.getInstance=function(){return b};this.getErrors=function(){return b.errors};this.setCompile=function(c){b.compile=c};this.setIR=function(c){b.ir=c};this.getIR=function(){return b.ir};this.setPreprocess=function(c){b.preprocess=c};this.getPreprocess=function(){return b.preprocess};this.getScript=function(){return b.script};this.reset=function(){b=new Annotated.State.__Internal()};this.reset()});__m.load({name:"Annotated.Util",mixins:{},type:"Module"},function(){Import:Annotated.State;Import:Annotated.Loader;this.getOrCreate=Annotated.Loader.getOrCreate;this.extend=Annotated.Loader.extend;this.assign=Annotated.Loader.assign;this.cache=function(a){var c={};for(var b=0;b<a.length;b++){c[a[b]]=this.getOrCreate(a[b])}return c};this.logError=function(a){console.error(a);Annotated.State.getInstance().errors.push(a);Annotated.State.getInstance().valid=false};this.keys=function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){a.push(b)}}return a}});__m.load({name:"Annotated.Reflect.Parse",mixins:{},type:"Module"},function(){Import:Annotated.State;Import:Annotated.Util;this.clean=function(a){var e=new RegExp("(\\/\\/|\\/\\*|\\\\\"|\\\\'|[\\(,=^;]\\s*?/(?!/)|\\/|/)|['\"]","gm");var g=false;var j="";var b=null;var h=[];while(quote=e.exec(a)){if((quote[0]==='\\"'||quote[0]==="\\'"||quote[0]==="\\/")&&g){}else{if(quote[0]===j&&g){j="";g=false;h.push([b,e.lastIndex])}else{if(quote[0][quote[0].length-1]==="/"&&j==="/"){j="";g=false;h.push([b,e.lastIndex])}else{if(quote[0]==="//"&&!g){var d=/$/gm;d.lastIndex=e.lastIndex;d.exec(a);h.push([e.lastIndex,d.lastIndex]);e.lastIndex=d.lastIndex}else{if(quote[0]==="/*"&&!g){var c=/\*\//gm;c.lastIndex=e.lastIndex;c.exec(a);h.push([e.lastIndex,c.lastIndex]);e.lastIndex=c.lastIndex}else{if(quote[0][quote[0].length-1]==="/"&&!g){j="/";g=true;b=e.lastIndex}else{if(g){}else{if(quote[0]==="'"||quote[0]==='"'){j=quote[0];g=true;b=e.lastIndex}}}}}}}}}h=h.reverse();for(var f in h){if(h.hasOwnProperty(f)){a=a.slice(0,h[f][0]-1)+a.slice(h[f][1],a.length)}}return a};this.findModules=function(e){var g=new RegExp("(^|;|{)\\s*(Module|Class)\\s*:","gm");var d=new RegExp("(^|;|{)\\s*Strict\\s*?:\\s*?true","gm");var c=new RegExp("(^|;|{)\\s*Init\\s*?:\\s*?false","gm");var b=[];if(d.exec(e)){Annotated.State.getInstance().strict=true}if(c.exec(e)){Annotated.State.getInstance().autoinit=false}while(moduleParsed=g.exec(e)){var f=e.slice(g.lastIndex).match(/\s*(.*?)\s*?=\s*?function/)[1];var a=moduleParsed[2];this.validateModule(f);Annotated.Util.getOrCreate(f);Annotated.State.getInstance().uninitialized[f]=true;Annotated.State.getInstance().modules[f]={name:f,type:a};b.push(f)}return b};this.findTaggedSymbols=function(d,c){var b={};regex=new RegExp("(^|;|{)\\s*("+c+")\\s*:\\s*((var)?\\s+[a-zA-Z0-9_\\$]+\\s*=\\s*)?","gm");while(regex.exec(d.code)){var a=d.code.slice(regex.lastIndex).match(/([a-zA-Z0-9_\\.\\$]+)(\()?/);if(c==="Root"){b[a[1].replace("this.","")]="ROOT"}else{if(Annotated.State.getInstance().modules.hasOwnProperty(a[1])){if(Annotated.State.getInstance().modules[a[1]].type==="Class"&&d.type==="Module"&&c==="Mixin"){Annotated.Util.logError("Module "+d.name+" cannot mixin Class "+a[1])}else{if(a[2]!=undefined&&a[2]!=""){b[a[1]]="INSTANCE"}else{if(Annotated.State.getInstance().modules[a[1]].type==="Module"){b[a[1]]="MODULE"}else{b[a[1]]="STATIC"}}}}else{Annotated.Util.logError("Module "+d.name+" declares an illegal "+c+": "+a[1])}}}return b};this.findImplicitModules=function(b,f){var a={};for(var g in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(g)&&b!=g){var e=new RegExp("(^|;|{|\\(|\\*|\\+|-|=|\\\\)\\s*"+g.replace(".","\\.").replace("$","\\$")+"(?![a-zA-Z0-9_\\$])","gm");match:while(e.exec(f)){for(var d in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(d)&&d!=g){var c=new RegExp(d.replace(".","\\.").replace("$","\\$")+"(?![a-zA-Z0-9_\\$])","gm");c.lastIndex=e.lastIndex-g.length;if(path=c.exec(f)){if((c.lastIndex-e.lastIndex)==(d.length-g.length)){continue match}}}}if(!Annotated.State.getInstance().strict){a[g]=true}else{if(!Annotated.State.getInstance().modules[b].imports[g]){Annotated.Util.logError("Undeclared dependency "+g+" in "+b)}}}}}return a};this.validateModule=function(a){for(module in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(module)&&Annotated.State.getInstance().modules[module].name===a){Annotated.Util.logError(a+" declared twice")}}}});__m.load({name:"Annotated.Container",mixins:{},type:"Module"},function(){Import:Annotated.State;Import:Annotated.Util;Import:Annotated.Loader;this.loadModules=function(){var h=true;var l=0;var m=0;var d={};var e=[];if(Annotated.State.getInstance().compile){Annotated.State.getInstance().script+=Annotated.Reflect.render("__m","Annotated.Loader")}if(Annotated.State.getInstance().ir){Annotated.State.getInstance().ir=Annotated.State.getInstance().ir.reverse();while(Annotated.State.getInstance().ir.length>0){Annotated.Loader.initializeModule(Annotated.State.getInstance().ir.pop())}}else{while(h&&Annotated.State.getInstance().valid){for(var j in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(j)){var f=Annotated.State.getInstance().modules[j];if(!d[f.name]){var b=true;for(var a in f.imports){if(f.imports.hasOwnProperty(a)){if(!d[a]){b=false}}}if(b){if(Annotated.State.getInstance().preprocess){e.push({name:f.name,mixins:f.mixins,type:f.type})}else{if(Annotated.State.getInstance().compile){Annotated.State.getInstance().script+="__m.load("+JSON.stringify({name:f.name,mixins:f.mixins,type:f.type,root:f.root})+","+f.raw_code+");\n"}else{Annotated.Loader.initializeModule(f);this.checkForProperties(Annotated.Util.getOrCreate(f.name),f.name)}}delete (Annotated.State.getInstance().uninitialized[f.name]);d[f.name]=true;m++}}}}if(l===m){var c=0;for(var g in Annotated.State.getInstance().uninitialized){c++}if(c>0){Annotated.Util.logError("Dependencies are unsatisfiable for "+JSON.stringify(Annotated.Util.keys(Annotated.State.getInstance().uninitialized))+"; not loaded")}h=false}l=m}if(Annotated.State.getInstance().preprocess){Annotated.State.getInstance().ir="annotated.setIR("+JSON.stringify(e)+");"}}};this.checkForProperties=function(b,a){for(var c in b){if(b.hasOwnProperty(c)){if(typeof b[c]!=="function"&&typeof b[c]!=="undefined"){this.logError("Module "+a+" has illegal public property "+c)}}}}});__m.load({name:"Annotated.Init",mixins:{},type:"Module"},function(b){Import:Annotated.State;var a=false;this.registerInitializer=function(){if(!a){__init=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){if(Annotated.State.getInstance().autoinit){b()}},false)}else{if(document.attachEvent){timer=function(){setTimeout(function(){if(window.document.readyState=="complete"){if(Annotated.State.getInstance().autoinit){b()}}else{timer()}},500)};timer()}}}}});__m.load({name:"Annotated.Reflect",mixins:{},type:"Module"},function(){Import:Annotated.Reflect.Parse;Import:Annotated.State;Import:Annotated.Util;this.parseModules=function(){for(var f in Annotated.State.getInstance().modules){if(Annotated.State.getInstance().modules.hasOwnProperty(f)){var b=Annotated.State.getInstance().modules[f];b.code=Annotated.Reflect.Parse.clean(Annotated.Util.getOrCreate(f).toString());b.raw_code=Annotated.Util.getOrCreate(f).toString();var e=Annotated.Reflect.Parse.findTaggedSymbols(b,"Import");var d=Annotated.Reflect.Parse.findTaggedSymbols(b,"Mixin");var c=Annotated.Reflect.Parse.findTaggedSymbols(b,"Root");b.imports=Annotated.Util.extend({},e,d);b.mixins=d;b.root=Annotated.Util.keys(c)[0];b.imports=Annotated.Util.extend(b.imports,Annotated.Reflect.Parse.findImplicitModules(f,b.code))}}};this.parseAnnotated=function(b){b=Annotated.Reflect.Parse.clean(b);return Annotated.Reflect.Parse.findModules(b)};var a=function(d){var b="";for(var e=0;e<d.length;e++){var f=d[e];b+=f.replace(".","__")+"=new (function() {";module_instance=Annotated.Util.getOrCreate(f);for(var c in module_instance){if(module_instance.hasOwnProperty(c)){b+="this."+c+"="+module_instance[c].toString()+";"}}b+="})();\n"}return b};this.render=function(d){var c=Array.prototype.slice.call(arguments);var b=d+"=(function(){"+a(c.slice(1))+";return "+c[c.length-1]+"})();";for(i=1;i<c.length;i++){b=b.replace(new RegExp(c[i],"gm"),c[i].replace(".","__"))}return b}});__m.load({name:"Annotated",mixins:{"Annotated.State":"MODULE"},type:"Module",root:"__scope__"},function(){Mixin:Annotated.State;Import:var e=Annotated.Container;Import:var c=Annotated.Init;Import:var d=Annotated.Reflect;Import:var b=Annotated.Util;this.reset();var a=this.getInstance;delete (this["getInstance"]);Root:this.__scope__=function(j){var g=undefined;if(a().ir&&a().valid){a().valid=false;for(var h=0;h<a().ir.length;h++){b.getOrCreate(a().ir[h].name)}}else{if(!a().ir){g=b.cache(d.parseAnnotated(j.toString()))}}j();if(!a().ir){for(var f in g){if(g.hasOwnProperty(f)){b.extend(b.getOrCreate(f),g[f])}}}c.registerInitializer(this.initialize)};this.initialize=function(){if(!a().initialized){a().initialized=true;if(!a().ir){d.parseModules()}e.loadModules()}}});annotated=Annotated;
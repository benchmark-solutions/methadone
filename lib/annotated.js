__m=(function(){__Annotated____Loader=new (function(){this.initializeModule=function(a){var c=[];var b=[];if(a.type==="Module"){b.push({});c.push({});var e=this.getOrCreate(a.name);this.processMixins(a,b,c);e.apply(b[b.length-1]);if(a.root){this.assign(a.name,this.extend(b[b.length-1][a.root],b[b.length-1]))}else{this.assign(a.name,b[b.length-1])}b.pop();c.pop()}else{var d=this.generateClassConstructor(a,this.getOrCreate(a.name),b,c);this.assign(a.name,d)}};this.generateClassConstructor=function(d,e,a,b){var c=this;return function(){if(b.length>0&&b[b.length-1][d.name]){a.push(a[a.length-1]);delete (b[b.length-1][d.name])}else{a.push(this)}b.push({});c.processMixins(d,a,b);var f=Array.prototype.slice.call(arguments);e.apply(a[a.length-1],f);b.pop();return a.pop()}};this.processMixins=function(e,a,b){for(var c in e.mixins){if(e.mixins[c]==="MODULE"){this.extend(a[a.length-1],this.getOrCreate(c))}else{if(e.mixins[c]==="INSTANCE"){b[b.length-1][c]=true}else{var d=this.getOrCreate(c);this.extend(a[a.length-1],new d())}}}};this.assign=function(c,g){var f=c.split(".");var e=f[0];var b=window;if(f.length>1){var a=window[e];for(var d=1;d<f.length;d++){e=f[d];b=a;a=a[e]}}b[e]=this.extend(g,b[e])};this.getOrCreate=function(a){var d=window;a=a.split(".");for(var b=0;b<a.length;b++){var c=a[b];d[c]=d[c]||{};d=d[c]}return d};this.extend=function(d){var b=Array.prototype.slice.call(arguments).slice(1);for(var c=0;c<b.length;c++){var a=b[c];for(name in a){copy=a[name];if(d!==copy&&copy!==undefined){d[name]=copy}}}return d};this.load=function(a,b){this.getOrCreate(a.name);this.assign(a.name,b);this.initializeModule(a)+");\n"}})();return __Annotated____Loader})();__m.load({name:"Annotated.Loader",type:"Module",mixins:{}},function(){this.initializeModule=function(a){var c=[];var b=[];if(a.type==="Module"){b.push({});c.push({});var e=this.getOrCreate(a.name);this.processMixins(a,b,c);e.apply(b[b.length-1]);if(a.root){this.assign(a.name,this.extend(b[b.length-1][a.root],b[b.length-1]))}else{this.assign(a.name,b[b.length-1])}b.pop();c.pop()}else{var d=this.generateClassConstructor(a,this.getOrCreate(a.name),b,c);this.assign(a.name,d)}};this.generateClassConstructor=function(d,e,a,b){var c=this;return function(){if(b.length>0&&b[b.length-1][d.name]){a.push(a[a.length-1]);delete (b[b.length-1][d.name])}else{a.push(this)}b.push({});c.processMixins(d,a,b);var f=Array.prototype.slice.call(arguments);e.apply(a[a.length-1],f);b.pop();return a.pop()}};this.processMixins=function(e,a,b){for(var c in e.mixins){if(e.mixins[c]==="MODULE"){this.extend(a[a.length-1],this.getOrCreate(c))}else{if(e.mixins[c]==="INSTANCE"){b[b.length-1][c]=true}else{var d=this.getOrCreate(c);this.extend(a[a.length-1],new d())}}}};this.assign=function(c,g){var f=c.split(".");var e=f[0];var b=window;if(f.length>1){var a=window[e];for(var d=1;d<f.length;d++){e=f[d];b=a;a=a[e]}}b[e]=this.extend(g,b[e])};this.getOrCreate=function(a){var d=window;a=a.split(".");for(var b=0;b<a.length;b++){var c=a[b];d[c]=d[c]||{};d=d[c]}return d};this.extend=function(d){var b=Array.prototype.slice.call(arguments).slice(1);for(var c=0;c<b.length;c++){var a=b[c];for(name in a){copy=a[name];if(d!==copy&&copy!==undefined){d[name]=copy}}}return d};this.load=function(a,b){this.getOrCreate(a.name);this.assign(a.name,b);this.initializeModule(a)+");\n"}});__m.load({name:"Annotated.State.__Internal",type:"Class",mixins:{}},function(){this.strict=false;this.valid=true;this.initialized=false;this.uninitialized={};this.errors=[];this.modules={};this.autoinit=true;this.preprocess=false;this.compile=false;this.script=""});__m.load({name:"Annotated.State",type:"Module",mixins:{}},function(){Import:var a=Annotated.State.__Internal;var b;this.getInstance=function(){return b};this.getErrors=function(){return b.errors};this.setCompile=function(c){b.compile=c};this.setIR=function(c){b.ir=c};this.getIR=function(){return b.ir};this.setPreprocess=function(c){b.preprocess=c};this.getPreprocess=function(){return b.preprocess};this.getScript=function(){return b.script};this.reset=function(){b=new Annotated.State.__Internal()};this.reset()});__m.load({name:"Annotated.Util",type:"Module",mixins:{}},function(){Import:var b=Annotated.State;Import:var a=Annotated.Loader;this.getOrCreate=a.getOrCreate;this.extend=a.extend;this.assign=a.assign;this.cache=function(c){var e={};for(var d=0;d<c.length;d++){e[c[d]]=this.getOrCreate(c[d])}return e};this.logError=function(c){console.error(c);b.getInstance().errors.push(c);b.getInstance().valid=false};this.keys=function(e){var c=[];for(var d in e){if(e.hasOwnProperty(d)){c.push(d)}}return c}});__m.load({name:"Annotated.Reflect.Parse",type:"Module",mixins:{}},function(){Import:var b=Annotated.State;Import:var a=Annotated.Util;this.clean=function(c){var g=new RegExp("(\\/\\/|\\/\\*|\\\\\"|\\\\'|[\\(,=^;]\\s*?/(?!/)|\\/|/)|['\"]","gm");var j=false;var l="";var d=null;var k=[];while(quote=g.exec(c)){if((quote[0]==='\\"'||quote[0]==="\\'"||quote[0]==="\\/")&&j){}else{if(quote[0]===l&&j){l="";j=false;k.push([d,g.lastIndex])}else{if(quote[0][quote[0].length-1]==="/"&&l==="/"){l="";j=false;k.push([d,g.lastIndex])}else{if(quote[0]==="//"&&!j){var f=/$/gm;f.lastIndex=g.lastIndex;f.exec(c);k.push([g.lastIndex,f.lastIndex]);g.lastIndex=f.lastIndex}else{if(quote[0]==="/*"&&!j){var e=/\*\//gm;e.lastIndex=g.lastIndex;e.exec(c);k.push([g.lastIndex,e.lastIndex]);g.lastIndex=e.lastIndex}else{if(quote[0][quote[0].length-1]==="/"&&!j){l="/";j=true;d=g.lastIndex}else{if(j){}else{if(quote[0]==="'"||quote[0]==='"'){l=quote[0];j=true;d=g.lastIndex}}}}}}}}}k=k.reverse();for(var h in k){if(k.hasOwnProperty(h)){c=c.slice(0,k[h][0]-1)+c.slice(k[h][1],c.length)}}return c};this.findModules=function(g){var j=new RegExp("(^|;|{)\\s*(Module|Class)\\s*:","gm");var f=new RegExp("(^|;|{)\\s*Strict\\s*?:\\s*?true","gm");var e=new RegExp("(^|;|{)\\s*Init\\s*?:\\s*?false","gm");var d=[];if(f.exec(g)){b.getInstance().strict=true}if(e.exec(g)){b.getInstance().autoinit=false}while(moduleParsed=j.exec(g)){var h=g.slice(j.lastIndex).match(/\s*(.*?)\s*?=\s*?function/)[1];var c=moduleParsed[2];this.validateModule(h);a.getOrCreate(h);b.getInstance().uninitialized[h]=true;b.getInstance().modules[h]={name:h,type:c};d.push(h)}return d};this.findTaggedSymbols=function(f,e){var d={};regex=new RegExp("(^|;|{)\\s*("+e+")\\s*:\\s*((var)?\\s+[a-zA-Z0-9_\\$]+\\s*=\\s*)?","gm");while(regex.exec(f.code)){var c=f.code.slice(regex.lastIndex).match(/([a-zA-Z0-9_\\.\\$]+)(\()?/);if(e==="Root"){d[c[1].replace("this.","")]="ROOT"}else{if(b.getInstance().modules.hasOwnProperty(c[1])){if(b.getInstance().modules[c[1]].type==="Class"&&f.type==="Module"&&e==="Mixin"){a.logError("Module "+f.name+" cannot mixin Class "+c[1])}else{if(c[2]!=undefined&&c[2]!=""){d[c[1]]="INSTANCE"}else{if(b.getInstance().modules[c[1]].type==="Module"){d[c[1]]="MODULE"}else{d[c[1]]="STATIC"}}}}else{a.logError("Module "+f.name+" declares an illegal "+e+": "+c[1])}}}return d};this.findImplicitModules=function(d,h){var c={};for(var j in b.getInstance().modules){if(b.getInstance().modules.hasOwnProperty(j)&&d!=j){var g=new RegExp("(^|;|{|\\(|\\*|\\+|-|=|\\\\)\\s*"+j.replace(".","\\.").replace("$","\\$")+"(?![a-zA-Z0-9_\\$])","gm");match:while(g.exec(h)){for(var f in b.getInstance().modules){if(b.getInstance().modules.hasOwnProperty(f)&&f!=j){var e=new RegExp(f.replace(".","\\.").replace("$","\\$")+"(?![a-zA-Z0-9_\\$])","gm");e.lastIndex=g.lastIndex-j.length;if(path=e.exec(h)){if((e.lastIndex-g.lastIndex)==(f.length-j.length)){continue match}}}}if(!b.getInstance().strict){c[j]=true}else{if(!b.getInstance().modules[d].imports[j]){a.logError("Undeclared dependency "+j+" in "+d)}}}}}return c};this.validateModule=function(c){for(module in b.getInstance().modules){if(b.getInstance().modules.hasOwnProperty(module)&&b.getInstance().modules[module].name===c){a.logError(c+" declared twice")}}}});__m.load({name:"Annotated.Container",type:"Module",mixins:{}},function(){Import:var c=Annotated.State;Import:var b=Annotated.Util;Import:var a=Annotated.Loader;this.loadModules=function(){var n=true;var p=0;var q=0;var h={};var j=[];if(c.getInstance().compile){c.getInstance().script+=Annotated.Reflect.render("__m","Annotated.Loader")}if(c.getInstance().ir){c.getInstance().ir=c.getInstance().ir.reverse();while(c.getInstance().ir.length>0){a.initializeModule(c.getInstance().ir.pop())}}else{while(n&&c.getInstance().valid){for(var o in c.getInstance().modules){if(c.getInstance().modules.hasOwnProperty(o)){var l=c.getInstance().modules[o];if(!h[l.name]){var e=true;for(var d in l.imports){if(l.imports.hasOwnProperty(d)){if(!h[d]){e=false}}}if(e){var g=l.raw_code;delete (l.code);delete (l.imports);delete (l.raw_code);if(c.getInstance().preprocess){j.push(l)}else{if(c.getInstance().compile){c.getInstance().script+="__m.load("+JSON.stringify(l)+","+g+");\n"}else{a.initializeModule(l);this.checkForProperties(b.getOrCreate(l.name),l.name)}}delete (c.getInstance().uninitialized[l.name]);h[l.name]=true;q++}}}}if(p===q){var f=0;for(var m in c.getInstance().uninitialized){f++}if(f>0){b.logError("Dependencies are unsatisfiable for "+JSON.stringify(b.keys(c.getInstance().uninitialized))+"; not loaded")}n=false}p=q}if(c.getInstance().preprocess){c.getInstance().ir="annotated.setIR("+JSON.stringify(j)+");"}}};this.checkForProperties=function(e,d){for(var f in e){if(e.hasOwnProperty(f)){if(typeof e[f]!=="function"&&typeof e[f]!=="undefined"){this.logError("Module "+d+" has illegal public property "+f)}}}}});__m.load({name:"Annotated.Init",type:"Module",mixins:{}},function(c){Import:var a=Annotated.State;var b=false;this.registerInitializer=function(){if(!b){__init=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){if(a.getInstance().autoinit){c()}},false)}else{if(document.attachEvent){timer=function(){setTimeout(function(){if(window.document.readyState=="complete"){if(a.getInstance().autoinit){c()}}else{timer()}},500)};timer()}}}}});__m.load({name:"Annotated.Reflect",type:"Module",mixins:{}},function(){Import:var d=Annotated.Reflect.Parse;Import:var b=Annotated.State;Import:var a=Annotated.Util;this.parseModules=function(){for(var j in b.getInstance().modules){if(b.getInstance().modules.hasOwnProperty(j)){var e=b.getInstance().modules[j];e.code=d.clean(a.getOrCreate(j).toString());e.raw_code=a.getOrCreate(j).toString();var h=d.findTaggedSymbols(e,"Import");var g=d.findTaggedSymbols(e,"Mixin");var f=d.findTaggedSymbols(e,"Root");e.imports=a.extend({},h,g);e.mixins=g;e.root=a.keys(f)[0];e.imports=a.extend(e.imports,d.findImplicitModules(j,e.code))}}};this.parseAnnotated=function(e){e=d.clean(e);return d.findModules(e)};var c=function(g){var e="";for(var h=0;h<g.length;h++){var k=g[h];e+=k.replace(".","__")+"=new (function() {";module_instance=a.getOrCreate(k);for(var f in module_instance){if(module_instance.hasOwnProperty(f)){e+="this."+f+"="+module_instance[f].toString()+";"}}e+="})();\n"}return e};this.render=function(g){var f=Array.prototype.slice.call(arguments);var e=g+"=(function(){"+c(f.slice(1))+";return "+f[f.length-1]+"})();";for(i=1;i<f.length;i++){e=e.replace(new RegExp(f[i],"gm"),f[i].replace(".","__"))}return e}});__m.load({name:"Annotated",type:"Module",mixins:{"Annotated.State":"MODULE"},root:"__scope__"},function(){Mixin:Annotated.State;Import:var e=Annotated.Container;Import:var c=Annotated.Init;Import:var d=Annotated.Reflect;Import:var b=Annotated.Util;this.reset();var a=this.getInstance;delete (this["getInstance"]);Root:this.__scope__=function(j){var g=undefined;if(a().ir&&a().valid){a().valid=false;for(var h=0;h<a().ir.length;h++){b.getOrCreate(a().ir[h].name)}}else{if(!a().ir){g=b.cache(d.parseAnnotated(j.toString()))}}j();if(!a().ir){for(var f in g){if(g.hasOwnProperty(f)){b.extend(b.getOrCreate(f),g[f])}}}c.registerInitializer(this.initialize)};this.initialize=function(){if(!a().initialized){a().initialized=true;if(!a().ir){d.parseModules()}e.loadModules()}}});annotated=Annotated;
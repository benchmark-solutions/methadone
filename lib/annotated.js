__m=(function(){__Annotated____Loader=new (function(){this.initializeModule=function(a){a:Object;var c=[];var b=[];if(a.type==="Module"){b.push({});c.push({});var e=this.getOrCreate(a.name);this.processMixins(a,b,c);e.apply(b[b.length-1]);this.checkForProperties(a);if(a.root){this.assign(a.name,this.extend(b[b.length-1][a.root],b[b.length-1]))}else{this.assign(a.name,b[b.length-1])}this.addRestrictions(b[b.length-1],a);b.pop();c.pop()}else{var d=this.generateClassConstructor(a,this.getOrCreate(a.name),b,c);this.assign(a.name,d)}};this.generateClassConstructor=function(d,e,a,b){d:Object;e:Function;a:Array;b:Array;var c=this;return function(){if(b.length>0&&b[b.length-1][d.name]){a.push(a[a.length-1]);delete (b[b.length-1][d.name])}else{a.push(this)}b.push({});c.processMixins(d,a,b);var f=Array.prototype.slice.call(arguments);c.checkRestrictions(d,f);e.apply(a[a.length-1],f);c.checkForProperties(d);c.addRestrictions(a[a.length-1],d);b.pop();return a.pop()}};this.processMixins=function(e,a,b){e:Object;a:Array;b:Array;for(var c in e.mixins){if(e.mixins[c]==="MODULE"){this.extend(a[a.length-1],this.getOrCreate(c))}else{if(e.mixins[c]==="INSTANCE"){b[b.length-1][c]=true}else{var d=this.getOrCreate(c);this.extend(a[a.length-1],new d())}}}};this.assign=function(c,g){c:String;var f=c.split(".");var e=f[0];var b=window;if(f.length>1){var a=window[e];for(var d=1;d<f.length;d++){e=f[d];b=a;a=a[e]}}b[e]=this.extend(g,b[e])};this.checkForProperties=function(a){a:Object;var b=this.getOrCreate(a.name);for(var c in b){if(b.hasOwnProperty(c)){if(typeof b[c]!=="function"&&typeof b[c]!=="undefined"&&typeof b[c]!=="object"){throw new Error("Module "+a.name+" has illegal public property "+c)}}}};this.checkRestrictions=function(c,a){c:Object;a:Array;var d=this.getOrCreate(c.name);var b=0;for(var e in c.restrictions){if(c.restrictions.hasOwnProperty(e)){if(c.restrictions[e]!=="None"&&typeof a[b]!==c.restrictions[e]){throw Error("Module "+c.name+" type error; "+e+"::"+c.restrictions[e]+" invoked with "+a[b]+"::"+(typeof a[b]))}}}};this.addRestrictions=function(d,a){d:Object;a:Object;for(var e in d){if(d.hasOwnProperty(e)){if(typeof d[e]==="function"){var b=this.findRestrictions(this.clean(d[e].toString()));var c=d[e];d[e]=this.typeFn(b,e,d,d[e]);this.extend(d[e],c)}}}};this.typeFn=function(c,e,d,b){c:Object;e:String;d:Object;b:Function;var a=function(){var f=Array.prototype.slice.call(arguments);var g=0;for(var h in c){if(c[h]==="array"){if(!(f[g] instanceof Array)){throw Error("Type Error; "+f[g]+" is not a "+c[h])}}else{if((f[g] instanceof Array)&&c[h]!=="None"){throw Error("Type Error; "+f[g]+"(Array) is not a "+c[h]+" in method "+e)}else{if(c[h]!=="None"&&typeof f[g]!==c[h]){throw Error("Type Error; "+f[g]+" is not a "+c[h])}}}g++}return b.apply(d,f)};a.toString=function(){return b.toString()};return a};this.findParams=function(b){b:String;var c=new RegExp("\\((.*?)\\)","gm").exec(b)[1].split(",");for(var a=0;a<c.length;a++){c[a]=c[a].trim();if(c[a]===""){return[]}}return c};this.findRestrictions=function(e){e:String;var a={Import:true,Mixin:true};params=this.findParams(e);var e=e.split("{")[1].split(/(;)/gm);var d={};var f=true;for(var g in params){d[params[g]]="None"}for(var c=0;(c<e.length)&&f;c+=2){f=false;var b=e[c].split(":");for(var g in params){if(b[0].trim()!=""){if(params[g]===b[0].trim()){d[b[0].trim()]=b[1].replace(";","").toLowerCase().trim();f=true}else{if(a[b[0].trim()]){f=true}}}else{f=true}}}return d};this.clean=function(a){a:String;var e=new RegExp("(\\/\\/|\\/\\*|\\\\\"|\\\\'|[\\(,=^;]\\s*?/(?!/)|\\/|/)|['\"]","gm");var g=false;var j="";var b=null;var h=[];while(quote=e.exec(a)){if((quote[0]==='\\"'||quote[0]==="\\'"||quote[0]==="\\/")&&g){}else{if(quote[0]===j&&g){j="";g=false;h.push([b,e.lastIndex])}else{if(quote[0][quote[0].length-1]==="/"&&j==="/"){j="";g=false;h.push([b,e.lastIndex])}else{if(quote[0]==="//"&&!g){var d=/$/gm;d.lastIndex=e.lastIndex;d.exec(a);h.push([e.lastIndex-1,d.lastIndex]);e.lastIndex=d.lastIndex}else{if(quote[0]==="/*"&&!g){var c=/\*\//gm;c.lastIndex=e.lastIndex;c.exec(a);h.push([e.lastIndex,c.lastIndex]);e.lastIndex=c.lastIndex}else{if(quote[0][quote[0].length-1]==="/"&&!g){j="/";g=true;b=e.lastIndex}else{if(g){}else{if(quote[0]==="'"||quote[0]==='"'){j=quote[0];g=true;b=e.lastIndex}}}}}}}}}h=h.reverse();for(var f in h){if(h.hasOwnProperty(f)){a=a.slice(0,h[f][0]-1)+a.slice(h[f][1],a.length)}}return a};this.getOrCreate=function(a){a:String;var d=window;a=a.split(".");for(var b=0;b<a.length;b++){var c=a[b];d[c]=d[c]||{};d=d[c]}return d};this.extend=function(d){var b=Array.prototype.slice.call(arguments).slice(1);for(var c=0;c<b.length;c++){var a=b[c];for(name in a){copy=a[name];if(d!==copy&&copy!==undefined){if(d[name]){}else{d[name]=copy}}}}return d};this.load=function(a,b){a:Object;b:String;window.Boolean={};this.getOrCreate(a.name);this.assign(a.name,b);this.initializeModule(a)+");\n"}})();return __Annotated____Loader})();__m.load({name:"Annotated.Loader",type:"Module",mixins:{},restrictions:{}},function(){this.initializeModule=function(a){a:Object;var c=[];var b=[];if(a.type==="Module"){b.push({});c.push({});var e=this.getOrCreate(a.name);this.processMixins(a,b,c);e.apply(b[b.length-1]);this.checkForProperties(a);if(a.root){this.assign(a.name,this.extend(b[b.length-1][a.root],b[b.length-1]))}else{this.assign(a.name,b[b.length-1])}this.addRestrictions(b[b.length-1],a);b.pop();c.pop()}else{var d=this.generateClassConstructor(a,this.getOrCreate(a.name),b,c);this.assign(a.name,d)}};this.generateClassConstructor=function(d,e,a,b){d:Object;e:Function;a:Array;b:Array;var c=this;return function(){if(b.length>0&&b[b.length-1][d.name]){a.push(a[a.length-1]);delete (b[b.length-1][d.name])}else{a.push(this)}b.push({});c.processMixins(d,a,b);var f=Array.prototype.slice.call(arguments);c.checkRestrictions(d,f);e.apply(a[a.length-1],f);c.checkForProperties(d);c.addRestrictions(a[a.length-1],d);b.pop();return a.pop()}};this.processMixins=function(e,a,b){e:Object;a:Array;b:Array;for(var c in e.mixins){if(e.mixins[c]==="MODULE"){this.extend(a[a.length-1],this.getOrCreate(c))}else{if(e.mixins[c]==="INSTANCE"){b[b.length-1][c]=true}else{var d=this.getOrCreate(c);this.extend(a[a.length-1],new d())}}}};this.assign=function(c,g){c:String;var f=c.split(".");var e=f[0];var b=window;if(f.length>1){var a=window[e];for(var d=1;d<f.length;d++){e=f[d];b=a;a=a[e]}}b[e]=this.extend(g,b[e])};this.checkForProperties=function(a){a:Object;var b=this.getOrCreate(a.name);for(var c in b){if(b.hasOwnProperty(c)){if(typeof b[c]!=="function"&&typeof b[c]!=="undefined"&&typeof b[c]!=="object"){throw new Error("Module "+a.name+" has illegal public property "+c)}}}};this.checkRestrictions=function(c,a){c:Object;a:Array;var d=this.getOrCreate(c.name);var b=0;for(var e in c.restrictions){if(c.restrictions.hasOwnProperty(e)){if(c.restrictions[e]!=="None"&&typeof a[b]!==c.restrictions[e]){throw Error("Module "+c.name+" type error; "+e+"::"+c.restrictions[e]+" invoked with "+a[b]+"::"+(typeof a[b]))}}}};this.addRestrictions=function(d,a){d:Object;a:Object;for(var e in d){if(d.hasOwnProperty(e)){if(typeof d[e]==="function"){var b=this.findRestrictions(this.clean(d[e].toString()));var c=d[e];d[e]=this.typeFn(b,e,d,d[e]);this.extend(d[e],c)}}}};this.typeFn=function(c,e,d,b){c:Object;e:String;d:Object;b:Function;var a=function(){var f=Array.prototype.slice.call(arguments);var g=0;for(var h in c){if(c[h]==="array"){if(!(f[g] instanceof Array)){throw Error("Type Error; "+f[g]+" is not a "+c[h])}}else{if((f[g] instanceof Array)&&c[h]!=="None"){throw Error("Type Error; "+f[g]+"(Array) is not a "+c[h]+" in method "+e)}else{if(c[h]!=="None"&&typeof f[g]!==c[h]){throw Error("Type Error; "+f[g]+" is not a "+c[h])}}}g++}return b.apply(d,f)};a.toString=function(){return b.toString()};return a};this.findParams=function(b){b:String;var c=new RegExp("\\((.*?)\\)","gm").exec(b)[1].split(",");for(var a=0;a<c.length;a++){c[a]=c[a].trim();if(c[a]===""){return[]}}return c};this.findRestrictions=function(e){e:String;var a={Import:true,Mixin:true};params=this.findParams(e);var e=e.split("{")[1].split(/(;)/gm);var d={};var f=true;for(var g in params){d[params[g]]="None"}for(var c=0;(c<e.length)&&f;c+=2){f=false;var b=e[c].split(":");for(var g in params){if(b[0].trim()!=""){if(params[g]===b[0].trim()){d[b[0].trim()]=b[1].replace(";","").toLowerCase().trim();f=true}else{if(a[b[0].trim()]){f=true}}}else{f=true}}}return d};this.clean=function(a){a:String;var e=new RegExp("(\\/\\/|\\/\\*|\\\\\"|\\\\'|[\\(,=^;]\\s*?/(?!/)|\\/|/)|['\"]","gm");var g=false;var j="";var b=null;var h=[];while(quote=e.exec(a)){if((quote[0]==='\\"'||quote[0]==="\\'"||quote[0]==="\\/")&&g){}else{if(quote[0]===j&&g){j="";g=false;h.push([b,e.lastIndex])}else{if(quote[0][quote[0].length-1]==="/"&&j==="/"){j="";g=false;h.push([b,e.lastIndex])}else{if(quote[0]==="//"&&!g){var d=/$/gm;d.lastIndex=e.lastIndex;d.exec(a);h.push([e.lastIndex-1,d.lastIndex]);e.lastIndex=d.lastIndex}else{if(quote[0]==="/*"&&!g){var c=/\*\//gm;c.lastIndex=e.lastIndex;c.exec(a);h.push([e.lastIndex,c.lastIndex]);e.lastIndex=c.lastIndex}else{if(quote[0][quote[0].length-1]==="/"&&!g){j="/";g=true;b=e.lastIndex}else{if(g){}else{if(quote[0]==="'"||quote[0]==='"'){j=quote[0];g=true;b=e.lastIndex}}}}}}}}}h=h.reverse();for(var f in h){if(h.hasOwnProperty(f)){a=a.slice(0,h[f][0]-1)+a.slice(h[f][1],a.length)}}return a};this.getOrCreate=function(a){a:String;var d=window;a=a.split(".");for(var b=0;b<a.length;b++){var c=a[b];d[c]=d[c]||{};d=d[c]}return d};this.extend=function(d){var b=Array.prototype.slice.call(arguments).slice(1);for(var c=0;c<b.length;c++){var a=b[c];for(name in a){copy=a[name];if(d!==copy&&copy!==undefined){if(d[name]){}else{d[name]=copy}}}}return d};this.load=function(a,b){a:Object;b:String;window.Boolean={};this.getOrCreate(a.name);this.assign(a.name,b);this.initializeModule(a)+");\n"}});__m.load({name:"Annotated.Model.State",type:"Class",mixins:{},restrictions:{}},function(){this.strict=false;this.valid=true;this.initialized=false;this.uninitialized={};this.errors=[];this.modules={};this.autoinit=true;this.preprocess=false;this.compile=false;this.script=""});__m.load({name:"Annotated.State",type:"Module",mixins:{},restrictions:{}},function(){Import:Annotated.Model.State;var a;this.getInstance=function(){return a};this.getErrors=function(){return a.errors};this.setCompile=function(b){b:Boolean;a.compile=b};this.setIR=function(b){b:Boolean;a.ir=b};this.getIR=function(){return a.ir};this.setPreprocess=function(b){a.preprocess=b};this.getPreprocess=function(){return a.preprocess};this.getScript=function(){return a.script};this.reset=function(){a=new Annotated.Model.State()};this.reset()});__m.load({name:"Annotated.Util",type:"Module",mixins:{},restrictions:{}},function(){Import:var b=Annotated.State;Import:var a=Annotated.Loader;this.getOrCreate=a.getOrCreate;this.extend=a.extend;this.assign=a.assign;this.cache=function(c){var e={};for(var d=0;d<c.length;d++){e[c[d]]=this.getOrCreate(c[d])}return e};this.logError=function(c){c:String;console.error(c);b.getInstance().errors.push(c);b.getInstance().valid=false};this.exists=function(c){c:String;var f="";var g=window;c=c.split(".");for(var d=0;d<c.length;d++){var e=c[d];g=g[e];f+="."+e;if(g===undefined){break}else{if(typeof g!=="object"){return f.slice(1)}}}return undefined};this.keys=function(e){e:Object;var c=[];for(var d in e){if(e.hasOwnProperty(d)){c.push(d)}}return c}});__m.load({name:"Annotated.Reflection.Parse",type:"Module",mixins:{},restrictions:{}},function(){Import:var e=Annotated.State;Import:var b=Annotated.Util;Import:Annotated.Loader;var d="([a-zA-Z_\\$][a-zA-Z0-9_\\$]*)";var h="([a-zA-Z_\\$][a-zA-Z0-9_\\$]*)(.([a-zA-Z_\\$][a-zA-Z0-9_\\$]*))*";var a="(^|;|{)";var g="(^|;|{|\\(|\\*|\\+|-|=|~|\\!|\\/|new)";var c="\\s*?";var f="(?![a-zA-Z0-9_\\$])";this.clean=Annotated.Loader.clean;this.findParams=function(i){return Annotated.Loader.findParams(i.code)};this.findRestrictions=function(i){return Annotated.Loader.findRestrictions(i.code)};this.findModules=function(m){m:String;var p=new RegExp(a+c+"(Module|Class)"+c+":","gm");var l=new RegExp(a+c+"Strict"+c+":"+c+"true","gm");var k=new RegExp(a+c+"Init"+c+":"+c+"false","gm");var j=[];if(l.exec(m)){e.getInstance().strict=true}if(k.exec(m)){e.getInstance().autoinit=false}while(moduleParsed=p.exec(m)){var o=m.slice(p.lastIndex).match(/\s*(.*?)\s*?=\s*?function/)[1];var i=moduleParsed[2];var n=b.exists(o);if(n){b.logError("Module name "+o+" conflicts with "+n);break}this.validateModule(o);e.getInstance().uninitialized[o]=true;e.getInstance().modules[o]={name:o,type:i};j.push(o)}return j};this.findTaggedSymbols=function(l,k){l:Object;k:String;var j={};regex=new RegExp(a+c+"("+k+")"+c+":\\s*((var\\s+)?"+d+c+"="+c+")?","gm");while(regex.exec(l.code)){var i=l.code.slice(regex.lastIndex).match(/([a-zA-Z0-9_\\.\\$]+)(\()?/);if(k==="Root"){j[i[1].replace("this.","")]="ROOT"}else{if(e.getInstance().modules.hasOwnProperty(i[1])){if(e.getInstance().modules[i[1]].type==="Class"&&l.type==="Module"&&k==="Mixin"){b.logError("Module "+l.name+" cannot mixin Class "+i[1])}else{if(i[2]!=undefined&&i[2]!=""){j[i[1]]="INSTANCE"}else{if(e.getInstance().modules[i[1]].type==="Module"){j[i[1]]="MODULE"}else{j[i[1]]="STATIC"}}}}else{b.logError("Module "+l.name+" declares an illegal "+k+": "+i[1])}}}return j};this.findImplicitModules=function(j,n){j:String;n:String;var i={};for(var o in e.getInstance().modules){if(e.getInstance().modules.hasOwnProperty(o)&&j!=o){var m=new RegExp(g+c+o.replace(".","\\.").replace("$","\\$")+f,"gm");match:while(m.exec(n)){for(var l in e.getInstance().modules){if(e.getInstance().modules.hasOwnProperty(l)&&l!=o){var k=new RegExp(l.replace(".","\\.").replace("$","\\$")+f,"gm");k.lastIndex=m.lastIndex-o.length;if(path=k.exec(n)){if((k.lastIndex-m.lastIndex)===(l.length-o.length)&&l.length>o.length){continue match}}}}if(!e.getInstance().strict){i[o]=true}else{if(!e.getInstance().modules[j].imports[o]){b.logError("Undeclared dependency "+o+" in "+j)}}}}}return i};this.validateModule=function(i){i:String;for(module in e.getInstance().modules){if(e.getInstance().modules.hasOwnProperty(module)&&e.getInstance().modules[module].name===i){b.logError(i+" declared twice")}}}});__m.load({name:"Annotated.Init",type:"Module",mixins:{},restrictions:{}},function(){Import:var a=Annotated.State;var b=false;this.registerInitializer=function(c){c:Function;if(!b){__init=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){if(a.getInstance().autoinit){c()}},false)}else{if(document.attachEvent){timer=function(){setTimeout(function(){if(window.document.readyState=="complete"){if(a.getInstance().autoinit){c()}}else{timer()}},500)};timer()}}}}});__m.load({name:"Annotated.Reflect.Core",type:"Module",mixins:{},restrictions:{}},function(){Import:var c=Annotated.Reflection.Parse;Import:var b=Annotated.State;Import:var a=Annotated.Util;this.parseModules=function(){var g=b.getInstance().modules;for(var i in g){if(g.hasOwnProperty(i)){var d=g[i];d.code=c.clean(a.getOrCreate(i).toString());d.raw_code=a.getOrCreate(i).toString();var h=c.findTaggedSymbols(d,"Import");var f=c.findTaggedSymbols(d,"Mixin");var e=c.findTaggedSymbols(d,"Root");d.imports=a.extend({},h,f);d.mixins=f;d.root=a.keys(e)[0];d.imports=a.extend(d.imports,c.findImplicitModules(i,d.code));d.restrictions=c.findRestrictions(d)}}};this.parseAnnotated=function(d){d:String;return c.findModules(c.clean(d))};this.render=function(g){g:String;var f=Array.prototype.slice.call(arguments);var k=f.slice(1);var d="";for(var h=0;h<k.length;h++){var l=k[h];d+=l.replace(".","__")+"=new (function() {";module_instance=a.getOrCreate(l);for(var e in module_instance){if(module_instance.hasOwnProperty(e)){d+="this."+e+"="+module_instance[e].toString()+";"}}d+="})();\n"}d=g+"=(function(){"+d+";return "+f[f.length-1]+"})();";for(h=1;h<f.length;h++){d=d.replace(new RegExp(f[h],"gm"),f[h].replace(".","__"))}return d}});__m.load({name:"Annotated.Container",type:"Module",mixins:{},restrictions:{}},function(){Import:var c=Annotated.State;Import:var b=Annotated.Util;Import:var a=Annotated.Loader;Import:Annotated.Reflect.Core;this.loadModules=function(){var m=true;var o=0;var p=0;var h={};var i=[];if(c.getInstance().compile){c.getInstance().script+=Annotated.Reflect.Core.render("__m","Annotated.Loader")}if(c.getInstance().ir){c.getInstance().ir=c.getInstance().ir.reverse();while(c.getInstance().ir.length>0){a.initializeModule(c.getInstance().ir.pop())}}else{while(m&&c.getInstance().valid){for(var n in c.getInstance().modules){if(c.getInstance().modules.hasOwnProperty(n)){var j=c.getInstance().modules[n];if(!h[j.name]){var e=true;for(var d in j.imports){if(j.imports.hasOwnProperty(d)){if(!h[d]){e=false}}}if(e){var g=j.raw_code;delete (j.code);delete (j.imports);delete (j.raw_code);if(c.getInstance().preprocess){i.push(j)}else{if(c.getInstance().compile){c.getInstance().script+="__m.load("+JSON.stringify(j)+","+g+");\n"}else{a.initializeModule(j)}}delete (c.getInstance().uninitialized[j.name]);h[j.name]=true;p++}}}}if(o===p){var f=0;for(var l in c.getInstance().uninitialized){f++}if(f>0){b.logError("Dependencies are unsatisfiable for "+JSON.stringify(b.keys(c.getInstance().uninitialized))+"; not loaded")}m=false}o=p}if(c.getInstance().preprocess){c.getInstance().ir="annotated.setIR("+JSON.stringify(i)+");"}}}});__m.load({name:"Annotated.Core",type:"Module",mixins:{"Annotated.State":"MODULE"},root:"__scope__",restrictions:{}},function(){Mixin:Annotated.State;Import:var f=Annotated.Container;Import:var d=Annotated.Init;Import:var e=Annotated.Reflect.Core;Import:var c=Annotated.Util;this.reset();var b=this.getInstance;var a=this;Root:this.__scope__=function(k){k:String;var h=undefined;if(b().ir&&b().valid){b().valid=false;for(var j=0;j<b().ir.length;j++){c.getOrCreate(b().ir[j].name)}}else{if(!b().ir){h=c.cache(e.parseAnnotated(k.toString()))}}k();if(!b().ir){for(var g in h){if(h.hasOwnProperty(g)){c.extend(c.getOrCreate(g),h[g])}}}d.registerInitializer(a.initialize)};this.initialize=function(){if(!b().initialized){b().initialized=true;if(!b().ir){e.parseModules()}f.loadModules()}}});annotated=Annotated.Core;